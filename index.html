<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker </title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet" />
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBVUNSzQhpam3Hw-YBaC9cEV3GB2-sUdzM",
            authDomain: "finance-tracker-3adf6.firebaseapp.com",
            projectId: "finance-tracker-3adf6",
            storageBucket: "finance-tracker-3adf6.firebasestorage.app",
            messagingSenderId: "365243611842",
            appId: "1:365243611842:web:5024869f516baa8583195b",
            measurementId: "G-31RC6QB97T"
        };

        // Initialize Firebase
        const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make auth and db available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthFunctions = {
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            updateProfile,
            onAuthStateChanged
        };
        window.firebaseFirestoreFunctions = {
            doc,
            setDoc,
            getDoc
        };

        // Redirect to dashboard if already logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.location.href = "dashboard.html";
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- Left Side  -->
    <div class="left">
        <div class="icon-box">
            <span class="material-icons">trending_up</span>
        </div>

        <h1>Manage Your Money</h1>

        <p>Track expenses, visualize spending patterns, and take control of your finances with our intuitive personal finance tracker.</p>

        <ul>
            <li>Real-time expense tracking</li>
            <li>Smart analytics & insights</li>
            <li>Export & backup your data</li>
        </ul>
    </div>
    <!-- Right Side  -->
        <div class="card">
            <div class="tab-buttons">
                <button id="btnSignIn" class="active">Sign In</button>
                <button id="btnCreate" type="submit">Create Account</button>
            </div>
            <!-- Sign In form -->
                 <form id="signInForm">
    <div class="form-group">
        <span class="material-icons">email</span>
        <input id="login_email" type="email" placeholder="your@example.com">
    </div>

    <div class="form-group">
        <span class="material-icons">lock</span>
        <input id="login_password" type="password" placeholder="●●●●●●">
    </div>

    <button class="btn">Sign In</button>
</form>

     <!-- Create account form -->
      <form id="createForm" style="display:none;">
    <div class="form-group">
        <span class="material-icons">person</span>
        <input id="username" type="text" placeholder="Your Names">
    </div>

    <div class="form-group">
        <span class="material-icons">email</span>
        <input id="email" type="email" placeholder="your@example.com">
    </div>

    <div class="form-group">
        <span class="material-icons">lock</span>
        <input id="new_password" type="password" placeholder="Create password">
    </div>

    <button class="btn">Create Account</button>
</form>

        </div>

    </div>


    <script>
    const btnSignIn = document.getElementById("btnSignIn");
    const btnCreate = document.getElementById("btnCreate");

    const signInForm = document.getElementById("signInForm");
    const createForm = document.getElementById("createForm");

    // Switch Tabs
    btnSignIn.onclick = () => {
        btnSignIn.classList.add("active");
        btnCreate.classList.remove("active");
        signInForm.style.display = "block";
        createForm.style.display = "none";
    };

    btnCreate.onclick = () => {
        btnCreate.classList.add("active");
        btnSignIn.classList.remove("active");
        signInForm.style.display = "none";
        createForm.style.display = "block";
    };

    // -----------------------------
    //  FIREBASE AUTHENTICATION SYSTEM
    // -----------------------------

    // Wait for Firebase to load
    function waitForFirebase(callback) {
        if (window.firebaseAuth && window.firebaseDb) {
            callback();
        } else {
            setTimeout(() => waitForFirebase(callback), 100);
        }
    }

    // CREATE ACCOUNT
    createForm.addEventListener("submit", async function(e) {
        e.preventDefault();

        const username = document.getElementById("username").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("new_password").value;

        if (username === "" || email === "" || password === "") {
            alert("All fields are required!");
            return;
        }

        if (password.length < 6) {
            alert("Password must be at least 6 characters long!");
            return;
        }

        waitForFirebase(async () => {
            try {
                const { createUserWithEmailAndPassword, updateProfile } = window.firebaseAuthFunctions;
                const { doc, setDoc } = window.firebaseFirestoreFunctions;
                const auth = window.firebaseAuth;
                const db = window.firebaseDb;

                // Create user with Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Update user profile with display name
                await updateProfile(user, { displayName: username });

                // Create user document in Firestore
                await setDoc(doc(db, "users", user.uid), {
                    username: username,
                    email: email,
                    createdAt: new Date().toISOString()
                });

                // Initialize user data collections
                await setDoc(doc(db, `transactions_${user.uid}`, "data"), {
                    transactions: []
                });
                await setDoc(doc(db, `categories_${user.uid}`, "data"), {
                    categories: []
                });
                await setDoc(doc(db, `preferences_${user.uid}`, "data"), {
                    currency: "USD",
                    emailNotifications: true
                });

                alert("Account created successfully! You can now Sign In.");
                createForm.reset();
                btnSignIn.click();
            } catch (error) {
                console.error("Error creating account:", error);
                if (error.code === "auth/email-already-in-use") {
                    alert("This email is already registered!");
                } else if (error.code === "auth/weak-password") {
                    alert("Password is too weak!");
                } else {
                    alert("Error creating account: " + error.message);
                }
            }
        });
    });

    // SIGN IN
    signInForm.addEventListener("submit", async function(e) {
        e.preventDefault();

        const email = document.getElementById("login_email").value.trim();
        const password = document.getElementById("login_password").value;

        if (email === "" || password === "") {
            alert("Please enter email and password!");
            return;
        }

        waitForFirebase(async () => {
            try {
                const { signInWithEmailAndPassword } = window.firebaseAuthFunctions;
                const auth = window.firebaseAuth;

                // Sign in with Firebase Auth
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Store user info in localStorage for easy access
                localStorage.setItem("firebaseUser", JSON.stringify({
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName
                }));

                alert("Login successful!");
                // Small delay to ensure auth state is set
                setTimeout(() => {
                    window.location.href = "dashboard.html";
                }, 100);
            } catch (error) {
                console.error("Error signing in:", error);
                if (error.code === "auth/user-not-found") {
                    alert("No account found with this email!");
                } else if (error.code === "auth/wrong-password") {
                    alert("Incorrect password!");
                } else if (error.code === "auth/invalid-email") {
                    alert("Invalid email address!");
                } else {
                    alert("Error signing in: " + error.message);
                }
            }
        });
    });
</script>

</body>
</html>